<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" prefix="og: http://ogp.me/ns#" xmlns:og="http://ogp.me/ns#"><!--<![endif]-->

    <head>
                <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="author" content="">
  
	
        <meta property="og:site_name" content="Staaldraad">
        <meta property="og:title" content="Staaldraad">
        <meta property="og:url" content="https://staaldraad.github.io/2016/10/03/powershell-shells/">
        <meta property="og:description" content="">
    
        <meta property="og:type" content="article" />
        <meta property="og:article:author" content="" />
        <meta property="og:article:published_time" content="2016-10-03T15:31:39Z" />
    
        <meta name="generator" content="Hugo 0.31-DEV" />
        <title>Powershell Shells &middot; Staaldraad</title>
        <link rel="canonical" href="https://staaldraad.github.io/" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="">
        <link rel="stylesheet" type="text/css" href="https://staaldraad.github.io/css/main.css"/>
        <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300|Montserrat:700" rel="stylesheet" type="text/css">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
        <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
    </head>

<body>
<!--[if lt IE 7]><p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chrome/â€Ž">install Google Chrome</a> to experience this site.</p><![endif]-->

    <header id="site-header">
        <div class="container">
            <a href="https://staaldraad.github.io/" alt="Staaldraad"><h1 class="blog-title heading">Staaldraad</h1></a>
            <p class="blog-description"></p>
        </div>
    </header>
<main class="content" role="main">
	<div class="container">
		<article class="post">
	<header class="post-header">
        <h3 class="p-post-title">Powershell Shells</h3>
    </header>

    <section class="post-content">
        <p>It&rsquo;s been a while&hellip; I figured it&rsquo;s about time I post something here again.</p>

<p>A while back I was required to see how much damage can be done by a malicious staff member. The one caveat here was that I had to test directly from the Windows box and had extremely limited outbound comms. For various reasons the usual tool-suites were out and I took this as a challenge to see how much damage I could do by coding tools on the &ldquo;employee machine&rdquo;.</p>

<p>I was able to get <a href="https://github.com/PowerShellMafia/PowerSploit">Powerview</a> onto the box, which helped identify possible targets on the network. One of the targets identified was an instance of ManageEngine with default credentials. Browsing around this instance I quickly found that you could upload files or scripts to excute on the ManageEngine box. Natuarally I could do something simple like upload the commands I want to execute all contained within a single file. However I was in the mood for interactive access. All ports other than 8080 were firewalled off, but the ManageEngine box was able to talk back to the workstation under my control. This created a new issue, what to upload? Why not some powershell? For this I re-used a Reverse Shell in Powershell that I&rsquo;d written a while back,
{% gist staaldraad/204928a6004e89553a8d3db0ce527fd5 %}</p>

<p>With my reverse shell on the target, I needed a listener to actually receive the connection. Usually I would use Netcat (nc) for this, however, I had no nc instance available to me. Powershell to the rescue, a few lines of Powershell later, we have a Listener in Powershell,
{% gist staaldraad/8473da7f2dfed28b2216b15ca6ebad11 %}</p>

<p>This allows us to &ldquo;catch&rdquo; an incomming shell and establish a two-way communication channel. This is rather crude and rudimentary but was sufficient in allowing me to fully compromise the ManageEngine box.</p>

<p>A rather simple solution but hopefully comes in use to someone in the future. In most cases you would probably get Powershell Empire set-up, for those times you don&rsquo;t, you now have a simple Powershell reverse shell and listener.</p>

    </section>

    <hr>

    <footer class="post-footer">
        <section class="f-1">
            
            
            <p class="f-post-time"><time datetime="2016-10-03T15:31:39Z">October 3, 2016</time></p>
        </section>
                        
        <section class="f-2">
            <section class="share">
                <span>Share:
                <a class="icon-twitter" href="http://twitter.com/share?text=Powershell%20Shells&url=https%3a%2f%2fstaaldraad.github.io%2f2016%2f10%2f03%2fpowershell-shells%2f"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="fa fa-twitter"></i>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fstaaldraad.github.io%2f2016%2f10%2f03%2fpowershell-shells%2f"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="fa fa-facebook"></i>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https%3a%2f%2fstaaldraad.github.io%2f2016%2f10%2f03%2fpowershell-shells%2f"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="fa fa-google-plus"></i>
                </a>
                </span>
            </section>

            
        </section>
                        
    </footer>
</article>
	</div>
</main>
    <footer id="site-footer">
        <div class="container">
          
          
          
          
          <a href="https://staaldraad.github.io/index.xml" title="Get the RSS feed"><span class="tooltip"><i class="fa fa-rss"></i></span></a>
          <section>&copy; <a href="https://staaldraad.github.io/"></a> 2017 | All rights reserved</section>
          <section>Theme by <a href="http://www.jrdnbwmn.com">Jordan Bowman</a>. Generated with <a href="http://gohugo.io/">Hugo</a>.</section>
        </div>
    </footer>

    <script type="text/javascript" src="https://staaldraad.github.io/js/fittext.js"></script>
    <script type="text/javascript">
      $(".heading").fitText();
    </script>



</body>
</html>